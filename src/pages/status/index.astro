---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import StatusCard from "@components/status/StatusCard.astro";

// 获取所有说说，按日期倒序排列
const statusEntries = await getCollection("status");
type StatusEntry = CollectionEntry<"status">;
const sortedStatus: StatusEntry[] = statusEntries.sort(
  (a: StatusEntry, b: StatusEntry) =>
    b.data.published.getTime() - a.data.published.getTime(),
);

// 只显示最新30条
const displayStatus: StatusEntry[] = sortedStatus.slice(0, 30);

const pageTitle = "说说";
const pageDescription = "生活点滴，随时记录";

let delay = 0;
const interval = 80;
---

<MainGridLayout title={pageTitle} description={pageDescription}>
  <div class="flex flex-col w-full">
    <!-- 页面头部横条 -->
    <div
      class="relative mb-6 md:mb-8 rounded-[var(--radius-large)] overflow-hidden onload-animation"
      style="animation-delay: var(--content-delay);"
    >
      <div
        class="relative px-6 md:px-12 py-8 md:py-14 bg-gradient-to-br from-[oklch(0.7_0.15_var(--hue))] to-[oklch(0.8_0.12_var(--hue))]"
      >
        <!-- 装饰性背景图案 -->
        <div
          class="absolute inset-0 opacity-10"
          style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"
        >
        </div>

        <!-- 标题和统计 -->
        <div class="relative z-10">
          <h1
            class="text-3xl md:text-5xl font-bold text-white mb-2 md:mb-3 drop-shadow-lg"
          >
            {pageTitle}
          </h1>
          <p
            class="text-white/90 text-base md:text-xl mb-3 md:mb-4 drop-shadow"
          >
            {pageDescription}
          </p>
          <div
            class="flex items-center gap-2 text-white/80 text-xs md:text-base"
          >
            <svg
              class="w-4 h-4 md:w-5 md:h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
              >
              </path>
            </svg>
            <span>{displayStatus.length} 条说说的记录</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 说说列表 -->
    <div class="flex flex-col gap-4 md:gap-5">
      {
        displayStatus.map((entry, index) => (
          <StatusCard
            entry={entry}
            class="onload-animation"
            style={`animation-delay: calc(var(--content-delay) + ${index * interval}ms);`}
          />
        ))
      }
    </div>

    <!-- 底部提示 -->
    {
      sortedStatus.length > 30 && (
        <div class="text-center py-8 text-black/40 dark:text-white/40 text-sm onload-animation">
          最新30条说说的记录
        </div>
      )
    }

    <!-- 空状态 -->
    {
      displayStatus.length === 0 && (
        <div class="card-base rounded-[var(--radius-large)] p-12 text-center onload-animation">
          <svg
            class="w-16 h-16 mx-auto mb-4 text-black/20 dark:text-white/20"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
            />
          </svg>
          <p class="text-black/40 dark:text-white/40 text-lg">还没有说说记录</p>
        </div>
      )
    }
  </div>
</MainGridLayout>

<style>
  /* 响应式调整 */
  @media (max-width: 768px) {
    .from-\[oklch\(0\.7_0\.15_var\(--hue\)\)\] {
      padding: 2rem 1.5rem;
    }
  }
</style>
